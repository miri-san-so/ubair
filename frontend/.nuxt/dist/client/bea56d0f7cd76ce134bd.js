(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{153:function(t,e,n){var content=n(175);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(42).default)("0b070394",content,!0,{sourceMap:!1})},154:function(t,e,n){"use strict";var o=n(3),r=n(17),c=n(20),l=n(106),d=n(62),f=n(9),m=n(43).f,v=n(63).f,h=n(8).f,_=n(155).trim,y=o.Number,k=y,w=y.prototype,S="Number"==c(n(77)(w)),x="trim"in String.prototype,C=function(t){var e=d(t,!1);if("string"==typeof e&&e.length>2){var n,o,r,c=(e=x?e.trim():_(e,3)).charCodeAt(0);if(43===c||45===c){if(88===(n=e.charCodeAt(2))||120===n)return NaN}else if(48===c){switch(e.charCodeAt(1)){case 66:case 98:o=2,r=49;break;case 79:case 111:o=8,r=55;break;default:return+e}for(var code,l=e.slice(2),i=0,f=l.length;i<f;i++)if((code=l.charCodeAt(i))<48||code>r)return NaN;return parseInt(l,o)}}return+e};if(!y(" 0o1")||!y("0b1")||y("+0x1")){y=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof y&&(S?f((function(){w.valueOf.call(n)})):"Number"!=c(n))?l(new k(C(e)),n,y):C(e)};for(var N,T=n(7)?m(k):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),O=0;T.length>O;O++)r(k,N=T[O])&&!r(y,N)&&h(y,N,v(k,N));y.prototype=w,w.constructor=y,n(10)(o,"Number",y)}},155:function(t,e,n){var o=n(6),r=n(21),c=n(9),l=n(156),d="["+l+"]",f=RegExp("^"+d+d+"*"),m=RegExp(d+d+"*$"),v=function(t,e,n){var r={},d=c((function(){return!!l[t]()||"​"!="​"[t]()})),f=r[t]=d?e(h):l[t];n&&(r[n]=f),o(o.P+o.F*d,"String",r)},h=v.trim=function(t,e){return t=String(r(t)),1&e&&(t=t.replace(f,"")),2&e&&(t=t.replace(m,"")),t};t.exports=v},156:function(t,e){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},157:function(t,e,n){var content=n(177);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(42).default)("8d1eabba",content,!0,{sourceMap:!1})},158:function(t,e,n){var content=n(179);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(42).default)("610560dc",content,!0,{sourceMap:!1})},159:function(t,e,n){var content=n(181);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(42).default)("4c24b3d6",content,!0,{sourceMap:!1})},174:function(t,e,n){"use strict";var o=n(153);n.n(o).a},175:function(t,e,n){(e=n(41)(!1)).push([t.i,"*[data-v-17efdb2a]{font-family:Inter,sans-serif;margin:0;padding:0;box-sizing:border-box;font-weight:400;font-size:1em}h3[data-v-17efdb2a]{margin-bottom:.5rem}h3[data-v-17efdb2a],h4[data-v-17efdb2a]{font-size:.9em}.bold[data-v-17efdb2a]{font-weight:600}span[data-v-17efdb2a]{font-size:.85em}.italic[data-v-17efdb2a]{font-style:italic}.card[data-v-17efdb2a]{word-break:break-all;display:flex;flex-direction:column;padding:2rem;background:linear-gradient(300.68deg,#0f0f0f .01%,transparent 42.67%,#0f0f0f 92.06%);border-radius:.8rem;margin:1rem 1rem 3rem}button[data-v-17efdb2a]:focus{outline:none}.accept[data-v-17efdb2a]{border:none;background-color:#00ff85;color:#000;width:80%;padding:1em;margin-top:1em;justify-self:center;align-self:center}.margin-bottom[data-v-17efdb2a]{margin-bottom:1.3em}",""]),t.exports=e},176:function(t,e,n){"use strict";var o=n(157);n.n(o).a},177:function(t,e,n){(e=n(41)(!1)).push([t.i,"@import url(https://fonts.googleapis.com/css2?family=Inter:wght@600;700&family=Montserrat:ital,wght@0,700;1,500&display=swap);"]),e.push([t.i,"*[data-v-bcf952f2]{font-family:Inter,sans-serif}.slidecontainer[data-v-bcf952f2]{width:100%}.slider[data-v-bcf952f2]{-webkit-appearance:none;width:calc(100vw - 4rem);height:.1rem;border-radius:5px;background:#fff;outline:none;opacity:.7;transition:opacity .2s;padding-left:.5rem;padding-right:.5rem;margin-bottom:3rem;margin-top:2rem}.slider[data-v-bcf952f2]:hover{opacity:1}h1[data-v-bcf952f2]{font-weight:700}.slider[data-v-bcf952f2]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:1rem;height:1rem;background:#fff;cursor:pointer;border-radius:.5rem}.slider[data-v-bcf952f2]::-moz-range-thumb{width:1rem;height:1rem;border-radius:.5rem;background:#fff;cursor:pointer}svg[data-v-bcf952f2]{transform:translateY(3px);margin-left:1rem}span[data-v-bcf952f2]{padding:.5rem 1rem;border-radius:1rem;font-size:.7rem;border:1px solid #4c4c4c;font-weight:500;font-family:Montserrat,sans-serif;margin-bottom:2rem}.info[data-v-bcf952f2]{padding:0 2rem;height:calc(85vh - 1rem);display:grid;grid-template-rows:1fr 2fr 2.5fr .5fr 1fr;grid-gap:1rem;gap:1rem}.payment-request[data-v-bcf952f2]{width:100%;display:flex;justify-content:center;align-items:center}.received[data-v-bcf952f2]{height:-webkit-max-content;height:-moz-max-content;height:max-content;align-self:self-start;justify-self:self-start;place-self:self-start}.payment-info[data-v-bcf952f2]{display:grid}.rating_text[data-v-bcf952f2]{font-size:1rem;border-radius:2.5rem;padding:1rem 2rem;align-self:center;opacity:0;-webkit-animation:slideup-data-v-bcf952f2 .3s ease-in-out forwards;animation:slideup-data-v-bcf952f2 .3s ease-in-out forwards}h3[data-v-bcf952f2]{font-family:Montserrat,sans-serif;font-size:.6rem;font-weight:500;letter-spacing:.5em}.rating[data-v-bcf952f2]{width:100%;display:flex;flex-direction:column;justify-content:center}button[data-v-bcf952f2]{font-family:Montserrat,sans-serif;width:-webkit-max-content!important;width:-moz-max-content!important;width:max-content!important;padding:1rem 1.5rem;background-color:#00ff85;border:1px solid #4c4c4c;color:#000;font-weight:500;text-align:center;border-radius:5px;justify-self:self-end;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;grid-row:5}button[data-v-bcf952f2]:disabled{-webkit-filter:grayscale(50);filter:grayscale(50)}.btn[data-v-bcf952f2]{transition:finite .3s ease-in-out}@-webkit-keyframes slideup-data-v-bcf952f2{0%{opacity:0;margin-left:-50px}to{opacity:1;margin-left:0}}@keyframes slideup-data-v-bcf952f2{0%{opacity:0;margin-left:-50px}to{opacity:1;margin-left:0}}",""]),t.exports=e},178:function(t,e,n){"use strict";var o=n(158);n.n(o).a},179:function(t,e,n){(e=n(41)(!1)).push([t.i,"@import url(https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Montserrat&display=swap);"]),e.push([t.i,"*[data-v-196052da]{font-family:Inter,sans-serif;margin:0;padding:0;box-sizing:border-box;font-weight:400;font-size:1em}h3[data-v-196052da]{margin-bottom:.5rem}h3[data-v-196052da],h4[data-v-196052da]{font-size:.9em}.bold[data-v-196052da]{font-weight:600}span[data-v-196052da]{font-size:.85em}.italic[data-v-196052da]{font-style:italic}.card[data-v-196052da]{word-break:break-all;display:flex;flex-direction:column;padding:2rem;background:linear-gradient(300.68deg,#0f0f0f .01%,transparent 42.67%,#0f0f0f 92.06%);border-radius:.8rem;margin:1rem 1rem 3rem}button[data-v-196052da]:focus{outline:none}.accept[data-v-196052da]{border:none;background-color:#00ff85;color:#000;width:80%;padding:1em;margin-top:1em;justify-self:center;align-self:center}.margin-bottom[data-v-196052da]{margin-bottom:1.3em}.trip[data-v-196052da]{display:grid;margin:0 2rem}.data[data-v-196052da]{display:flex;flex-direction:column;justify-content:space-between;margin-top:2rem;margin-bottom:2rem}.detailsHeading[data-v-196052da]{border-left:1.5px solid #0fa;padding-left:1em;font-size:1em;font-weight:600;font-family:Montserrat,sans-serif;letter-spacing:.15rem}input[data-v-196052da]{background-color:transparent;color:#fff;border:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:9em}input[data-v-196052da]:focus{outline:none;border:none}button[data-v-196052da]{width:100%;padding:.9em;border:none}buton[data-v-196052da]:focus{outline:none}.green[data-v-196052da]{background-color:#00ff85;color:#000;margin-top:2rem;margin-bottom:2rem}.gmap[data-v-196052da]{padding-left:1em;border-left:1px solid #6495ed;height:-webkit-max-content;height:-moz-max-content;height:max-content}.red[data-v-196052da]{background-color:tomato;color:#fff}.btn[data-v-196052da]{color:#000;background-color:transparent;margin-top:2rem;font-weight:600;letter-spacing:.15rem;font-size:.8em}.btn[data-v-196052da],.btn[data-v-196052da]:focus{border:none;outline:none}.complete-btn[data-v-196052da]{-webkit-animation:slide_up-data-v-196052da .3s ease-in-out .3s forwards;animation:slide_up-data-v-196052da .3s ease-in-out .3s forwards;background-color:#00ff85;margin-bottom:2rem}.cancel-btn[data-v-196052da],.complete-btn[data-v-196052da]{opacity:0;transition:all .3s ease-in-out}.cancel-btn[data-v-196052da]{-webkit-animation:slide_up-data-v-196052da .3s ease-in-out forwards;animation:slide_up-data-v-196052da .3s ease-in-out forwards;background-color:#ff3a3a;font-weight:700;color:#fff}.controls[data-v-196052da]{width:100%;justify-self:flex-end}.notification[data-v-196052da]{margin:1em 0;background:#cd5c5c;padding:1em;text-align:center;position:absolute;bottom:1rem;left:50%;transform:translateX(-50%);width:90%;-webkit-animation:sad-data-v-196052da 2s ease-in-out forwards;animation:sad-data-v-196052da 2s ease-in-out forwards}@-webkit-keyframes sad-data-v-196052da{0%{opacity:0;bottom:0}30%{opacity:1;bottom:1rem}80%{opacity:1;bottom:1rem}to{opacity:0;bottom:0}}@keyframes sad-data-v-196052da{0%{opacity:0;bottom:0}30%{opacity:1;bottom:1rem}80%{opacity:1;bottom:1rem}to{opacity:0;bottom:0}}@-webkit-keyframes slide_up-data-v-196052da{0%{opacity:0;transform:translateY(-5%)}to{opacity:1;transform:translateY(0)}}@keyframes slide_up-data-v-196052da{0%{opacity:0;transform:translateY(-5%)}to{opacity:1;transform:translateY(0)}}",""]),t.exports=e},180:function(t,e,n){"use strict";var o=n(159);n.n(o).a},181:function(t,e,n){(e=n(41)(!1)).push([t.i,"@import url(https://fonts.googleapis.com/css?family=Inter:400,800&display=swap);"]),e.push([t.i,".notification[data-v-5441c36d]{margin:1em 0;background:#cd5c5c;padding:1em;text-align:center;position:absolute;bottom:1rem;left:50%;transform:translateX(-50%);width:90%;-webkit-animation:sad-data-v-5441c36d 2s ease-in-out forwards;animation:sad-data-v-5441c36d 2s ease-in-out forwards;z-index:2}@-webkit-keyframes sad-data-v-5441c36d{0%{opacity:0;bottom:0}30%{opacity:1;bottom:1rem}80%{opacity:1;bottom:1rem}to{opacity:0;bottom:0}}@keyframes sad-data-v-5441c36d{0%{opacity:0;bottom:0}30%{opacity:1;bottom:1rem}80%{opacity:1;bottom:1rem}to{opacity:0;bottom:0}}*[data-v-5441c36d]{margin:0;padding:0;box-sizing:border-box;font-family:Inter,sans-serif}.pos[data-v-5441c36d]{padding:2rem;font-size:.7em;text-align:center}.passengers[data-v-5441c36d],.pos[data-v-5441c36d]{display:flex;margin:0;flex-direction:column;justify-content:center;align-items:center}button[data-v-5441c36d]:focus{outline:none}.allTrips[data-v-5441c36d]{margin-top:3rem;margin-bottom:10rem}.h3[data-v-5441c36d]{margin:1rem 0;font-size:.8em;letter-spacing:.25em}.bold[data-v-5441c36d]{font-weight:800}.all[data-v-5441c36d]{display:flex;flex-direction:column;justify-content:center}.find[data-v-5441c36d]{pointer-events:all;cursor:pointer;border:none;background-color:#00ff85;color:#000;width:100%;font-weight:600;position:fixed;bottom:0;right:0;padding:2rem 1rem}",""]),t.exports=e},215:function(t,e,n){"use strict";n.r(e);n(76),n(105),n(27);var o=n(5),r={name:"TripCard",props:{trip:{type:Object}},methods:{acceptRide:function(t){console.log("Emiiting Trip : ",this.trip),this.$emit("passengerId",this.trip)}}},c=(n(174),n(13)),l=Object(c.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"card",attrs:{id:t.trip.id}},[n("div",{staticClass:"margin-bottom pickup-info"},[n("h3",{staticClass:"bold"},[t._v("Pickup:")]),t._v(" "),n("h4",[t._v(t._s(t.trip.pickup_location.address.label))])]),t._v(" "),n("div",{staticClass:"margin-bottom drop-info"},[n("h3",{staticClass:"bold"},[t._v("Dropoff:")]),t._v(" "),n("h4",[t._v(t._s(t.trip.drop_location.address.label))])]),t._v(" "),n("span",{staticClass:"margin-bottom bold"},[t._v("Estimated fare is : Rs."+t._s((t.trip.trip_distance/1e3*17).toFixed(2)))]),t._v(" "),n("span",{staticClass:"margin-bottom bold"},[t._v(t._s(t.trip.trip_info))]),t._v(" "),n("button",{staticClass:"margin-bottom accept",on:{click:t.acceptRide}},[t._v("\n    Accept Ride!\n  ")])])}),[],!1,null,"17efdb2a",null).exports,d=(n(28),n(154),{name:"PassengerCompletedTrip.vue",data:function(){return{rating_value:null,is_received:!1,tripFare:0}},props:{socket:{type:Object},passengerInfo:{type:Object},cancelFare:{type:String,default:null},trip:{type:Object}},methods:{received:function(){this.is_received=!0,console.log("recieved");var t=this.passengerInfo.phone_number;this.socket.emit("receive",t,!0)},exit:function(){var t=this;this.socket.disconnect();var e=new Headers;e.append("Authorization","Bearer "+JSON.parse(localStorage.data).token),e.append("Content-Type","application/json");var n=JSON.stringify({phone_number:this.passengerInfo.phone_number,rating_value:Number(this.rating_value)});fetch("http://localhost:4002/rating",{method:"POST",headers:e,body:n,redirect:"follow"}).then((function(t){return t.text()})).then((function(e){t.$router.push({path:"/profile"})})).catch((function(t){return console.log("error",t)}))},ratingVal:function(t){this.rating_value=t.target.value}},created:function(){var t=this,e=new Headers;e.append("Authorization","Bearer "+JSON.parse(localStorage.data).token),e.append("Content-Type","application/json");var n=JSON.stringify({tripId:this.trip._id});fetch("http://localhost:4003/completed",{method:"POST",headers:e,body:n,redirect:"follow"}).then((function(t){return t.text()})).then((function(e){console.log(e),t.tripFare=JSON.parse(e).fare})).catch((function(t){return console.log("error",t)}))}}),f=(n(176),{name:"DriverSocket",components:{DriverCompletedTrip:Object(c.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"info"},[t._m(0),t._v(" "),n("div",{staticClass:"payment-info"},[n("h3",[t._v("TRIP COMPLETED")]),t._v(" "),null==t.cancelFare?n("h1",[t._v("Rs. "+t._s(t.tripFare.toFixed(2)))]):t._e(),t._v(" "),null!=t.cancelFare?n("h1",[t._v("Rs. "+t._s(t.cancelFare))]):t._e(),t._v(" "),n("button",{staticClass:"received",on:{click:t.received}},[t._v("RECEIVED")])]),t._v(" "),n("div",{staticClass:"rating"},[n("h3",[t._v("RATE Passenger")]),t._v(" "),n("div",[n("input",{staticClass:"slider",attrs:{disabled:!t.is_received,type:"range",min:"1",max:"5",value:"1",id:"rating"},on:{change:t.ratingVal}}),t._v(" "),1==t.rating_value?n("span",{staticClass:"rating_text"},[t._v("😭   Really Bad")]):t._e(),t._v(" "),2==t.rating_value?n("span",{staticClass:"rating_text"},[t._v("😔   Not So Good")]):t._e(),t._v(" "),3==t.rating_value?n("span",{staticClass:"rating_text"},[t._v("😐   Ok")]):t._e(),t._v(" "),4==t.rating_value?n("span",{staticClass:"rating_text"},[t._v("😄   Good")]):t._e(),t._v(" "),5==t.rating_value?n("span",{staticClass:"rating_text"},[t._v("😝   Awesome")]):t._e()])]),t._v(" "),n("button",{staticClass:"btn",attrs:{disabled:!t.is_received},on:{click:t.exit}},[t._v("\n    EXIT\n    "),n("svg",{attrs:{width:"10",height:"13",viewBox:"0 0 10 13",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[n("path",{attrs:{d:"M1 1L8.5 7L1 12.5",stroke:"black"}})])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"payment-request"},[e("span",[this._v("Please Collect The Money From The Passenger")])])}],!1,null,"bcf952f2",null).exports},props:{tripDetails:{type:Object},socket:{type:Object}},data:function(){return{passengerInfo:{},num:0,notif:!1,notif_msg:"",tripStarted:!1,tripCompleted:!1,cancelFare:null,trip:{type:Object}}},methods:{copyNumber:function(){var t=this,e=document.getElementById("phn");e.select(),e.setSelectionRange(0,99999),document.execCommand("copy"),this.notif=!0,setTimeout((function(){return t.notif=!1}),2e3),this.notif_msg="Copied the Phone Number"},getPassengerInfo:function(){var t=this,e=new Headers;e.append("Authorization","Bearer "+JSON.parse(localStorage.data).token),e.append("Content-Type","application/json");var n=JSON.stringify({id:this.tripDetails._id});fetch("http://localhost:4003/getTrip",{method:"POST",headers:e,body:n,redirect:"follow"}).then((function(t){return t.text()})).then((function(e){null!=e&&(t.passengerInfo=JSON.parse(e),t.num=JSON.parse(e).phone_number)})).catch((function(t){return console.log("error",t)}))},startTrip:function(){this.tripStarted=!0;var t=this.passengerInfo.phone_number;this.socket.emit("start",t,!0)},cancelTrip:function(){var t=this;navigator.geolocation!={}&&navigator.geolocation.getCurrentPosition((function(data){var e=data.coords.latitude,n=data.coords.longitude,o=new Headers;o.append("Authorization","Bearer "+JSON.parse(localStorage.data).token),o.append("Content-Type","application/json");var r=JSON.stringify({lat:t.trip.pickup_lat,long:t.trip.pickup_long,dropoff:"".concat(e,", ").concat(n)});fetch("http://localhost:4001/getPrice",{method:"POST",headers:o,body:r,redirect:"follow"}).then((function(t){return t.text()})).then((function(e){t.cancelFare=JSON.parse(e).fare,t.tripCompleted=!0;var n=t.passengerInfo.phone_number;t.trip.cancelFare=t.cancelFare;var o=t.trip;console.log("emitting complete on cancel..."),t.socket.emit("complete",n,!0,o);var r=new Headers;r.append("Authorization","Bearer "+JSON.parse(localStorage.data).token),r.append("Content-Type","application/json");var c=JSON.stringify({_id:t.trip._id,cancelFare:t.cancelFare});fetch("http://localhost:4003/cancel",{method:"POST",headers:r,body:c,redirect:"follow"}).then((function(t){return t.text()})).then((function(t){console.log(t)})).catch((function(t){return console.log("error",t)}))})).catch((function(t){return console.log("error",t)}))}))},completeTrip:function(){this.tripCompleted=!0;var t=this.passengerInfo.phone_number,e=this.trip;this.socket.emit("complete",t,!0,e),console.log("Do Stuff After Completed")}},created:function(){var t=this;this.getPassengerInfo();var e={passengerId:this.tripDetails._id,driverName:JSON.parse(localStorage.data).name,driverPhoneNumber:JSON.parse(localStorage.data).phone_number,trip_distance:this.tripDetails.trip_distance,pickup_label:this.tripDetails.pickup_location.address.label,dropoff_label:this.tripDetails.drop_location.address.label,trip_info:this.tripDetails.trip_info},n=new Headers;n.append("Authorization","Bearer "+JSON.parse(localStorage.data).token),n.append("Content-Type","application/json");var o=JSON.stringify(e);fetch("http://localhost:4003/accept",{method:"POST",headers:n,body:o,redirect:"follow"}).then((function(t){return t.text()})).then((function(n){t.trip=JSON.parse(n),t.$emit("trip",e);var data=t.trip,o=t.passengerInfo.phone_number;(console.log(t.trip),t.socket.emit("trip",o,data),"OK"!=n)&&("Passenger Not Available Anymore"==JSON.parse(n).message&&(localStorage.setItem("passenger_already_accepted",!0),setTimeout((function(){t.$router.push("/")}),100)))})).catch((function(t){return console.log("error",t)}))},mounted:function(){var t=this;setTimeout((function(){t.socket.on("connect",(function(){console.log("connected")})),t.socket.emit("join_room",{token:JSON.parse(localStorage.data).token,num:t.num}),t.socket.on("newUser",(function(data){console.log(data)})),t.socket.on("disconnect",(function(){t.removeFromQueue,console.log("disconnected")})),t.socket.on("reconnect",(function(){console.log("reconnecting...")})),t.socket.on("completed",(function(data){console.log("completed"),1==data&&(t.tripCompleted=data,window.navigator.vibrate([300,300]))})),t.socket.on("pingDriver",(function(data){if(1==data){t.tripCompleted=!0;var e=t.passengerInfo.phone_number,n=t.trip;t.socket.emit("complete",e,!0,n),console.log("Canceled By Passenger")}}))}),200)}}),m=(n(178),{head:{script:[{src:"https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"}]},methods:{getPassengers:function(){var t=this,e=new Headers;e.append("Authorization","Bearer "+JSON.parse(localStorage.data).token);fetch("http://localhost:4003/find",{method:"POST",headers:e,body:"",redirect:"follow"}).then((function(t){return t.text()})).then(function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,JSON.parse(n);case 2:"Token Expired"==(o=e.sent).message&&(localStorage.clear(),t.$router.push({name:"login"})),null==o.message?t.trips=o:(t.notif=!0,setTimeout((function(){return t.notif=!1}),2e3),t.notif_msg=o.message,"Cant Find Driver, Try Refreshing page"===o.message&&(navigator.geolocation!={}?navigator.geolocation.getCurrentPosition((function(data){var e=data.coords.latitude,n=data.coords.longitude;t.lat=e,t.long=n;var o=new Headers;o.append("Authorization","Bearer "+JSON.parse(localStorage.data).token),o.append("Content-Type","application/json");var r=JSON.stringify({lat:e,long:n});fetch("http://localhost:4001/",{method:"POST",headers:o,body:r,redirect:"follow"}).then((function(t){return t.text()})).then((function(e){null!=JSON.parse(e).doc?t.pos=JSON.parse(e).doc.address.label:t.pos=JSON.parse(e).address.label})).catch((function(t){return console.log("error",t)}))})):(t.notif=!0,setTimeout((function(){return t.notif=!1}),2e3),t.notif_msg="Unable to get your location")));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(t){return console.log("error",t)}))},makeConn:function(t){this.selectedTrip=t}},components:{TripCard:l,DriverSocket:Object(c.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[1==t.notif?n("span",{staticClass:"notification"},[t._v(t._s(t.notif_msg))]):t._e(),t._v(" "),1==t.tripCompleted?n("div",[n("DriverCompletedTrip",{attrs:{cancelFare:t.cancelFare,passengerInfo:t.passengerInfo,socket:t.socket,trip:t.trip}})],1):t._e(),t._v(" "),0==t.tripCompleted?n("div",{staticClass:"trip"},[0==t.tripStarted?n("div",{staticClass:"passengerDetils"},[n("strong",{staticClass:"detailsHeading"},[t._v("PASSENGER DETAILS")]),t._v(" "),n("div",{staticClass:"data"},[n("span",[n("strong",{staticClass:"bold"},[t._v("Name: ")]),t._v(t._s(this.passengerInfo.name))]),t._v(" "),n("span",[n("strong",{staticClass:"bold"},[t._v("Phone Number: ")]),n("input",{attrs:{readonlytype:"text",id:"phn"},domProps:{value:t.passengerInfo.phone_number},on:{click:t.copyNumber}})])])]):t._e(),t._v(" "),n("div",{staticClass:"TripDetails"},[n("strong",{staticClass:"detailsHeading"},[t._v("TRIP DETAILS")]),t._v(" "),n("div",{staticClass:"data"},[n("div",{staticClass:"margin-bottom pickup-info"},[n("h3",{staticClass:"bold"},[t._v("Pickup:")]),t._v(" "),n("h4",[t._v(t._s(t.tripDetails.pickup_location.address.label))])]),t._v(" "),n("div",{staticClass:"margin-bottom drop-info"},[n("h3",{staticClass:"bold"},[t._v("Dropoff:")]),t._v(" "),n("h4",[t._v(t._s(t.tripDetails.drop_location.address.label))])]),t._v(" "),n("span",{staticClass:"margin-bottom bold"},[t._v("Estimated fare is : Rs."+t._s((t.tripDetails.trip_distance/1e3*17).toFixed(2)))]),t._v(" "),n("span",{staticClass:"margin-bottom bold"},[t._v(t._s(t.tripDetails.trip_info))])])]),t._v(" "),n("a",{staticClass:"gmap",attrs:{target:"_blank",rel:"noopener noreferrer",href:"https://www.google.com/maps/dir/"+t.tripDetails.pickup_location.address.label+"/"+t.tripDetails.drop_location.address.label}},[t._v("\n      Google Maps Direction for Trip\n    ")]),t._v(" "),0==t.tripStarted?n("button",{staticClass:"green",on:{click:t.startTrip}},[t._v("\n      Start Trip\n    ")]):t._e(),t._v(" "),n("div",{staticClass:"controls"},[1==t.tripStarted?n("button",{staticClass:"cancel-btn btn",on:{click:t.cancelTrip}},[t._v("\n        CANCEL TRIP\n      ")]):t._e(),t._v(" "),1==t.tripStarted?n("button",{staticClass:"complete-btn btn",on:{click:t.completeTrip}},[t._v("\n        TRIP COMPLETED\n      ")]):t._e()])]):t._e()])}),[],!1,null,"196052da",null).exports},data:function(){return{selectedTrip:"",trips:[],pos:"",notif:!1,notif_msg:"",socket:{}}},mounted:function(){var t=this;if(null!=localStorage.passenger_already_accepted&&"true"==localStorage.passenger_already_accepted&&(this.notif=!0,setTimeout((function(){t.notif=!1,localStorage.removeItem("passenger_already_accepted")}),2e3),this.notif_msg="That Passenger has been Accepted by Someone else"),0!=localStorage.length){var data=JSON.parse(localStorage.data);if(data.token){var e=new Headers;e.append("Authorization","Bearer "+data.token),fetch("http://localhost:4000/u/verify",{method:"POST",headers:e,redirect:"follow"}).then((function(t){return t.text()})).then((function(e){if("Verified"==JSON.parse(e).message){var n=JSON.parse(localStorage.data).token.split(".")[1].replace("-","+").replace("_","/"),o=JSON.parse(window.atob(n));"driver"==o.type?navigator.geolocation?navigator.geolocation.getCurrentPosition((function(data){var e=data.coords.latitude,n=data.coords.longitude;t.lat=e,t.long=n;var o=new Headers;o.append("Authorization","Bearer "+JSON.parse(localStorage.data).token),o.append("Content-Type","application/json");var r=JSON.stringify({lat:e,long:n});fetch("http://localhost:4001/",{method:"POST",headers:o,body:r,redirect:"follow"}).then((function(t){return t.text()})).then((function(e){null!=JSON.parse(e).doc?t.pos=JSON.parse(e).doc.address.label:t.pos=JSON.parse(e).address.label,t.socket=io("http://localhost:4005/trip",{reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:1/0}),t.socket.on("connect",(function(){console.log("connected")}))})).catch((function(t){return console.log("error",t)}))})):(t.notif=!0,setTimeout((function(){return t.notif=!1}),2e3),t.notif_msg="Unable to get your location"):"passenger"==o.type?window.location="http://localhost:3000/ride":window.location="http://localhost:3000"}})).catch((function(t){return console.log("error",t)}))}}else window.location="http://localhost:3000"},beforeDestroy:function(){this.socket.disconnect()}}),v=(n(180),Object(c.a)(m,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"all"},[1==t.notif?n("span",{staticClass:"notification"},[t._v(t._s(t.notif_msg))]):t._e(),t._v(" "),""!=t.selectedTrip?n("div",{staticClass:"passengers"},[n("DriverSocket",{attrs:{socket:t.socket,tripDetails:t.selectedTrip}})],1):t._e(),t._v(" "),""==t.selectedTrip||null==t.selectedTrip?n("div",{staticClass:"passengers"},[n("span",{staticClass:"pos"},[n("strong",[t._v("Your Position :")]),t._v(" "+t._s(t.pos))]),t._v(" "),t.trips.length>0?n("span",{staticClass:"h3"},[t._v("\n      Found "),n("span",{staticClass:"bold"},[t._v(t._s(t.trips.length)+" Passenger")]),t._v(" Nearby\n    ")]):t._e(),t._v(" "),n("div",{staticClass:"allTrips"},t._l(t.trips,(function(e){return n("TripCard",{key:e.id,attrs:{trip:e},on:{passengerId:t.makeConn}})})),1),t._v(" "),n("button",{staticClass:"find",on:{click:function(e){return t.getPassengers()}}},[t._v("Find Me Passengers!")])]):t._e()])}),[],!1,null,"5441c36d",null));e.default=v.exports}}]);